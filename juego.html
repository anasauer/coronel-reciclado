<!DOCTYPE html>
<html lang="es">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Juego de Reciclado</title>
ย ย <script src="https://cdn.tailwindcss.com"></script>
ย ย <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
ย ย <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
ย ย <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700;900&display=swap" rel="stylesheet">
ย ย <style>
ย ย ย ย body {
ย ย ย ย ย ย font-family: 'Raleway', sans-serif;
ย ย ย ย ย ย background-image: url('img/ruinas.png');
ย ย ย ย ย ย background-size: cover;
ย ย ย ย ย ย background-position: center;
ย ย ย ย ย ย background-attachment: fixed;
ย ย ย ย ย ย color: #f9fafb;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย min-height: 100vh;
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย padding: 20px;
ย ย ย ย }
ย ย ย ย .game-wrapper {
ย ย ย ย ย ย background-color: rgba(17, 24, 39, 0.7);
ย ย ย ย ย ย padding: 2rem;
ย ย ย ย ย ย border-radius: 1.5rem;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย max-width: 600px;
ย ย ย ย }
ย ย ย ย #gameCanvas {
ย ย ย ย ย ย border-radius: 1rem;
ย ย ย ย ย ย background-color: rgba(20, 25, 20, 0.8);
ย ย ย ย ย ย border: 2px solid #4b5563;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย touch-action: none;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย height: auto;
ย ย ย ย ย ย max-width: 450px;
ย ย ย ย ย ย transition: all 0.3s ease;
ย ย ย ย }
ย ย ย ย .game-info {
ย ย ย ย ย ย margin: 1rem 0;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-wrap: wrap;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย gap: 1rem 2rem;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย }
ย ย ย ย .flash-red {
ย ย ย ย ย ย animation: incorrectPlacement 0.5s forwards;
ย ย ย ย }
ย ย ย ย @keyframes incorrectPlacement {
ย ย ย ย ย ย 0% { background-color: #ef4444; }
ย ย ย ย ย ย 100% { background-color: rgba(20, 25, 20, 0.8); }
ย ย ย ย }
ย ย ย ย .message-box {
ย ย ย ย ย ย position: absolute;
ย ย ย ย ย ย top: 50%;
ย ย ย ย ย ย left: 50%;
ย ย ย ย ย ย transform: translate(-50%, -50%);
ย ย ย ย ย ย background-color: rgba(0, 0, 0, 0.8);
ย ย ย ย ย ย border-radius: 1rem;
ย ย ย ย ย ย padding: 2rem;
ย ย ย ย ย ย border: 2px solid #3b82f6;
ย ย ย ย ย ย box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
ย ย ย ย ย ย display: none;
ย ย ย ย ย ย z-index: 100;
ย ย ย ย }
ย ย ย ย .btn {
ย ย ย ย ย ย background-color: #4b5563;
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย padding: 0.75rem 1.5rem;
ย ย ย ย ย ย border-radius: 9999px;
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย ย ย transition-property: background-color, transform;
ย ย ย ย ย ย transition-duration: 300ms;
ย ย ย ย ย ย transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
ย ย ย ย }
ย ย ย ย .btn:hover {
ย ย ย ย ย ย background-color: #6b7280;
ย ย ย ย ย ย transform: scale(1.05);
ย ย ย ย }
ย ย </style>
</head>
<body>
ย ย <div class="game-wrapper">
ย ย ย ย <h1 class="text-3xl font-bold mb-4">โป๏ธ Juego de Reciclado</h1>
ย ย ย ย <p class="mb-4">Arrastra y suelta los objetos en el contenedor correcto.</p>
ย ย ย ย <div class="game-info">
ย ย ย ย ย ย <div id="gameScore">Puntos: 0</div>
ย ย ย ย ย ย <div id="gameLives">Vidas: โค๏ธโค๏ธโค๏ธโค๏ธโค๏ธ</div>
ย ย ย ย ย ย <div id="gameTimer">Tiempo: 60</div>
ย ย ย ย ย ย <button id="backGameButton" class="btn bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-slate-900">
ย ย ย ย ย ย ย ย <i class="fas fa-arrow-left"></i>
ย ย ย ย ย ย ย ย <span>Regresar</span>
ย ย ย ย ย ย </button>
ย ย ย ย ย ย <button id="restartGameButton" class="btn bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-slate-900">
ย ย ย ย ย ย ย ย <i class="fas fa-arrows-rotate"></i>
ย ย ย ย ย ย ย ย <span>Reiniciar</span>
ย ย ย ย ย ย </button>
ย ย ย ย ย ย <button id="toggleButton" class="btn bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-slate-900">
ย ย ย ย ย ย ย ย <i id="toggleIcon" class="fas fa-pause"></i>
ย ย ย ย ย ย ย ย <span id="toggleText">Pausar</span>
ย ย ย ย ย ย </button>
ย ย ย ย </div>
ย ย ย ย <div class="relative w-full max-w-lg aspect-square">
ย ย ย ย ย ย <canvas id="gameCanvas"></canvas>
ย ย ย ย ย ย <div id="messageBox" class="message-box flex flex-col items-center justify-center text-center">
ย ย ย ย ย ย ย ย <h2 id="messageTitle" class="text-xl font-bold text-gray-100 mb-2"></h2>
ย ย ย ย ย ย ย ย <p id="messageText" class="text-gray-300 mb-4"></p>
ย ย ย ย ย ย ย ย <button id="restartButton" class="btn btn-green">
ย ย ย ย ย ย ย ย ย ย Jugar de Nuevo
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย <button id="returnButton" class="btn bg-gray-600 hover:bg-gray-700 mt-4">
ย ย ย ย ย ย ย ย ย ย Regresar a la pรกgina principal
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย <script>
ย ย ย ย class RecyclingGame {
ย ย ย ย ย ย constructor(canvas, scoreEl, livesEl, timerEl, messageBoxEl, messageTitleEl, messageTextEl, restartButtonEl, toggleButtonEl, toggleIconEl, toggleTextEl, returnButtonEl, backGameButtonEl) {
ย ย ย ย ย ย ย ย this.canvas = canvas;
ย ย ย ย ย ย ย ย this.ctx = this.canvas.getContext('2d');
ย ย ย ย ย ย ย ย this.scoreEl = scoreEl;
ย ย ย ย ย ย ย ย this.livesEl = livesEl;
ย ย ย ย ย ย ย ย this.timerEl = timerEl;
ย ย ย ย ย ย ย ย this.messageBoxEl = messageBoxEl;
ย ย ย ย ย ย ย ย this.messageTitleEl = messageTitleEl;
ย ย ย ย ย ย ย ย this.messageTextEl = messageTextEl;
ย ย ย ย ย ย ย ย this.restartButtonEl = restartButtonEl;
ย ย ย ย ย ย ย ย this.toggleButtonEl = toggleButtonEl;
ย ย ย ย ย ย ย ย this.toggleIconEl = toggleIconEl;
ย ย ย ย ย ย ย ย this.toggleTextEl = toggleTextEl;
ย ย ย ย ย ย ย ย this.returnButtonEl = returnButtonEl;ย
ย ย ย ย ย ย ย ย this.backGameButtonEl = backGameButtonEl;

ย ย ย ย ย ย ย ย this.items = [];
ย ย ย ย ย ย ย ย this.bins = [];
ย ย ย ย ย ย ย ย // Carga el puntaje de localStorage, si existe, si no, inicializa en 0
ย ย ย ย ย ย ย ย this.score = parseInt(localStorage.getItem('currentScore')) || 0;
ย ย ย ย ย ย ย ย this.lives = 5;
ย ย ย ย ย ย ย ย this.timer = 60;
ย ย ย ย ย ย ย ย this.gameOver = false;
ย ย ย ย ย ย ย ย this.isDragging = false;
ย ย ย ย ย ย ย ย this.draggedItem = null;
ย ย ย ย ย ย ย ย this.frameId = null;
ย ย ย ย ย ย ย ย this.spawnTimer = 0;
ย ย ย ย ย ย ย ย this.lastTime = 0;
ย ย ย ย ย ย ย ย this.paused = false;

ย ย ย ย ย ย ย ย this.itemTypes = [
ย ย ย ย ย ย ย ย ย ย { type: 'glass', icon: '๐พ', binSrc: 'img/vidrio.png', name: 'Vidrio' },
ย ย ย ย ย ย ย ย ย ย { type: 'paper', icon: '๐', binSrc: 'img/papel.png', name: 'Papel' },
ย ย ย ย ย ย ย ย ย ย { type: 'plastic', icon: '๐งด', binSrc: 'img/plastico.png', name: 'Plรกstico' },
ย ย ย ย ย ย ย ย ย ย { type: 'metal', icon: '๐ฅซ', binSrc: 'img/metal.png', name: 'Metal' },
ย ย ย ย ย ย ย ย ย ย { type: 'organic', icon: '๐', binSrc: 'img/organico.png', name: 'Orgรกnico' }
ย ย ย ย ย ย ย ย ];

ย ย ย ย ย ย ย ย this.correctSound = new Tone.Synth({
ย ย ย ย ย ย ย ย ย ย oscillator: { type: 'sine' },
ย ย ย ย ย ย ย ย ย ย envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.4 }
ย ย ย ย ย ย ย ย }).toDestination();
ย ย ย ย ย ย ย ย this.incorrectSound = new Tone.Synth({
ย ย ย ย ย ย ย ย ย ย oscillator: { type: 'square' },
ย ย ย ย ย ย ย ย ย ย envelope: { attack: 0.01, decay: 0.1, sustain: 0.01, release: 0.2 }
ย ย ย ย ย ย ย ย }).toDestination();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย this.resizeCanvas = this.resizeCanvas.bind(this);
ย ย ย ย ย ย ย ย this.gameLoop = this.gameLoop.bind(this);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Bind unified event handlers
ย ย ย ย ย ย ย ย this.handleStart = this.handleStart.bind(this);
ย ย ย ย ย ย ย ย this.handleMove = this.handleMove.bind(this);
ย ย ย ย ย ย ย ย this.handleEnd = this.handleEnd.bind(this);

ย ย ย ย ย ย ย ย this.restartButtonEl.addEventListener('click', () => this.restart());
ย ย ย ย ย ย ย ย this.toggleButtonEl.addEventListener('click', () => this.togglePause());
ย ย ย ย ย ย ย ย this.returnButtonEl.addEventListener('click', () => this.returnToHome());
ย ย ย ย ย ย ย ย this.backGameButtonEl.addEventListener('click', () => this.returnToHome());
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย this.addEventListeners();
ย ย ย ย ย ย }

ย ย ย ย ย ย addEventListeners() {
ย ย ย ย ย ย ย ย // Remove old listeners to prevent duplication
ย ย ย ย ย ย ย ย this.canvas.removeEventListener('mousedown', this.handleStart);
ย ย ย ย ย ย ย ย this.canvas.removeEventListener('mousemove', this.handleMove);
ย ย ย ย ย ย ย ย this.canvas.removeEventListener('mouseup', this.handleEnd);
ย ย ย ย ย ย ย ย this.canvas.removeEventListener('touchstart', this.handleStart);
ย ย ย ย ย ย ย ย this.canvas.removeEventListener('touchmove', this.handleMove);
ย ย ย ย ย ย ย ย this.canvas.removeEventListener('touchend', this.handleEnd);

ย ย ย ย ย ย ย ย // Add unified listeners
ย ย ย ย ย ย ย ย this.canvas.addEventListener('mousedown', this.handleStart);
ย ย ย ย ย ย ย ย this.canvas.addEventListener('mousemove', this.handleMove);
ย ย ย ย ย ย ย ย this.canvas.addEventListener('mouseup', this.handleEnd);
ย ย ย ย ย ย ย ย this.canvas.addEventListener('touchstart', this.handleStart);
ย ย ย ย ย ย ย ย this.canvas.addEventListener('touchmove', this.handleMove);
ย ย ย ย ย ย ย ย this.canvas.addEventListener('touchend', this.handleEnd);
ย ย ย ย ย ย }

ย ย ย ย ย ย getPointerPosition(e) {
ย ย ย ย ย ย ย ย const rect = this.canvas.getBoundingClientRect();
ย ย ย ย ย ย ย ย let clientX, clientY;

ย ย ย ย ย ย ย ย // Handle both mouse and touch events
ย ย ย ย ย ย ย ย if (e.touches && e.touches.length > 0) {
ย ย ย ย ย ย ย ย ย ย clientX = e.touches[0].clientX;
ย ย ย ย ย ย ย ย ย ย clientY = e.touches[0].clientY;
ย ย ย ย ย ย ย ย } else if (e.changedTouches && e.changedTouches.length > 0) {
ย ย ย ย ย ย ย ย ย ย clientX = e.changedTouches[0].clientX;
ย ย ย ย ย ย ย ย ย ย clientY = e.changedTouches[0].clientY;
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย clientX = e.clientX;
ย ย ย ย ย ย ย ย ย ย clientY = e.clientY;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย return {
ย ย ย ย ย ย ย ย ย ย x: clientX - rect.left,
ย ย ย ย ย ย ย ย ย ย y: clientY - rect.top
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย }

ย ย ย ย ย ย handleStart(e) {
ย ย ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ย ย ย if (this.gameOver || this.paused) return;
ย ย ย ย ย ย ย ย const pos = this.getPointerPosition(e);
ย ย ย ย ย ย ย ย for (let i = this.items.length - 1; i >= 0; i--) {
ย ย ย ย ย ย ย ย ย ย const item = this.items[i];
ย ย ย ย ย ย ย ย ย ย if (Math.abs(pos.x - item.x) < 20 && Math.abs(pos.y - item.y) < 20) {
ย ย ย ย ย ย ย ย ย ย ย ย this.isDragging = true;
ย ย ย ย ย ย ย ย ย ย ย ย this.draggedItem = item;
ย ย ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย handleMove(e) {
ย ย ย ย ย ย ย ย if (!this.isDragging || !this.draggedItem) return;
ย ย ย ย ย ย ย ย const pos = this.getPointerPosition(e);
ย ย ย ย ย ย ย ย this.draggedItem.x = pos.x;
ย ย ย ย ย ย ย ย this.draggedItem.y = pos.y;
ย ย ย ย ย ย }

ย ย ย ย ย ย handleEnd(e) {
ย ย ย ย ย ย ย ย if (!this.draggedItem) return;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Get the final position for the drop
ย ย ย ย ย ย ย ย const pos = this.getPointerPosition(e);
ย ย ย ย ย ย ย ย this.draggedItem.x = pos.x;
ย ย ย ย ย ย ย ย this.draggedItem.y = pos.y;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย let placedCorrectly = false;
ย ย ย ย ย ย ย ย for (const bin of this.bins) {
ย ย ย ย ย ย ย ย ย ย const xCollision = this.draggedItem.x > bin.x && this.draggedItem.x < bin.x + bin.width;
ย ย ย ย ย ย ย ย ย ย const yCollision = this.draggedItem.y > bin.y && this.draggedItem.y < bin.y + bin.height;

ย ย ย ย ย ย ย ย ย ย if (xCollision && yCollision) {
ย ย ย ย ย ย ย ย ย ย ย ย if (this.draggedItem.type === bin.type) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.score += 10;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย placedCorrectly = true;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.correctSound.triggerAttackRelease('C5', '8n');
ย ย ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.lives -= 1;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.canvas.classList.add('flash-red');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย setTimeout(() => this.canvas.classList.remove('flash-red'), 500);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.incorrectSound.triggerAttackRelease('C3', '8n');
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย this.items = this.items.filter(item => item !== this.draggedItem);
ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย this.isDragging = false;
ย ย ย ย ย ย ย ย this.draggedItem = null;
ย ย ย ย ย ย }

ย ย ย ย ย ย resizeCanvas() {
ย ย ย ย ย ย ย ย const container = this.canvas.parentElement;
ย ย ย ย ย ย ย ย const size = Math.min(container.clientWidth, 450);
ย ย ย ย ย ย ย ย this.canvas.width = size;
ย ย ย ย ย ย ย ย this.canvas.height = size;
ย ย ย ย ย ย ย ย this.initBins();
ย ย ย ย ย ย ย ย this.draw();
ย ย ย ย ย ย }

ย ย ย ย ย ย start() {
ย ย ย ย ย ย ย ย this.score = parseInt(localStorage.getItem('currentScore')) || 0;
ย ย ย ย ย ย ย ย this.lives = 5;
ย ย ย ย ย ย ย ย this.timer = 60;
ย ย ย ย ย ย ย ย this.gameOver = false;
ย ย ย ย ย ย ย ย this.items = [];
ย ย ย ย ย ย ย ย this.spawnTimer = 0;
ย ย ย ย ย ย ย ย this.lastTime = performance.now();
ย ย ย ย ย ย ย ย this.paused = false;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย this.toggleIconEl.classList.remove('fa-play');
ย ย ย ย ย ย ย ย this.toggleIconEl.classList.add('fa-pause');
ย ย ย ย ย ย ย ย this.toggleTextEl.textContent = 'Pausar';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย this.scoreEl.textContent = `Puntos: ${this.score}`;
ย ย ย ย ย ย ย ย this.livesEl.textContent = `Vidas: ${'โค๏ธ'.repeat(this.lives)}`;
ย ย ย ย ย ย ย ย this.timerEl.textContent = `Tiempo: ${this.timer}`;
ย ย ย ย ย ย ย ย this.messageBoxEl.style.display = 'none';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย this.resizeCanvas();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (this.frameId) {
ย ย ย ย ย ย ย ย ย ย cancelAnimationFrame(this.frameId);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย this.gameLoop(this.lastTime);
ย ย ย ย ย ย }

ย ย ย ย ย ย restart() {
ย ย ย ย ย ย ย ย // Reinicia el puntaje tanto en memoria como en localStorage
ย ย ย ย ย ย ย ย localStorage.setItem('currentScore', '0');
ย ย ย ย ย ย ย ย this.start();
ย ย ย ย ย ย }

ย ย ย ย ย ย // Guarda el puntaje en localStorage antes de regresar
ย ย ย ย ย ย returnToHome() {
ย ย ย ย ย ย ย ย if (this.frameId) {
ย ย ย ย ย ย ย ย ย ย cancelAnimationFrame(this.frameId);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย // Guarda el puntaje actual en localStorage
ย ย ย ย ย ย ย ย localStorage.setItem('currentScore', this.score.toString());
ย ย ย ย ย ย ย ย // Por razones de seguridad, es mejor no redirigir a URLs externas
ย ย ย ย ย ย ย ย // window.location.href = "home.html";
ย ย ย ย ย ย ย ย // En su lugar, podemos mostrar un mensaje
ย ย ย ย ย ย ย ย this.messageTitleEl.textContent = "Volverรกs pronto";
ย ย ย ย ย ย ย ย this.messageTextEl.textContent = `Puntuaciรณn guardada: ${this.score}.`;
ย ย ย ย ย ย ย ย this.messageBoxEl.style.display = 'flex';
ย ย ย ย ย ย ย ย this.returnButtonEl.style.display = 'none';
ย ย ย ย ย ย }

ย ย ย ย ย ย togglePause() {
ย ย ย ย ย ย ย ย this.paused = !this.paused;
ย ย ย ย ย ย ย ย if (this.paused) {
ย ย ย ย ย ย ย ย ย ย this.toggleIconEl.classList.remove('fa-pause');
ย ย ย ย ย ย ย ย ย ย this.toggleIconEl.classList.add('fa-play');
ย ย ย ย ย ย ย ย ย ย this.toggleTextEl.textContent = 'Reanudar';
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย this.toggleIconEl.classList.remove('fa-play');
ย ย ย ย ย ย ย ย ย ย this.toggleIconEl.classList.add('fa-pause');
ย ย ย ย ย ย ย ย ย ย this.toggleTextEl.textContent = 'Pausar';
ย ย ย ย ย ย ย ย ย ย this.lastTime = performance.now();
ย ย ย ย ย ย ย ย ย ย this.gameLoop(this.lastTime);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย initBins() {
ย ย ย ย ย ย ย ย this.bins = [];
ย ย ย ย ย ย ย ย const binWidth = this.canvas.width / this.itemTypes.length - 15;
ย ย ย ย ย ย ย ย const binHeight = this.canvas.height / 5;
ย ย ย ย ย ย ย ย const binY = this.canvas.height - binHeight - 20;

ย ย ย ย ย ย ย ย this.itemTypes.forEach((type, index) => {
ย ย ย ย ย ย ย ย ย ย const binImage = new Image();
ย ย ย ย ย ย ย ย ย ย binImage.src = type.binSrc;
ย ย ย ย ย ย ย ย ย ย binImage.onerror = () => { console.error(`Error loading image: ${type.binSrc}`); };
ย ย ย ย ย ย ย ย ย ย this.bins.push({
ย ย ย ย ย ย ย ย ย ย ย ย x: (index + 0.5) * (binWidth + 15) - binWidth / 2,
ย ย ย ย ย ย ย ย ย ย ย ย y: binY,
ย ย ย ย ย ย ย ย ย ย ย ย width: binWidth,
ย ย ย ย ย ย ย ย ย ย ย ย height: binHeight,
ย ย ย ย ย ย ย ย ย ย ย ย type: type.type,
ย ย ย ย ย ย ย ย ย ย ย ย name: type.name,
ย ย ย ย ย ย ย ย ย ย ย ย image: binImage
ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย }

ย ย ย ย ย ย spawnItem() {
ย ย ย ย ย ย ย ย const randomType = this.itemTypes[Math.floor(Math.random() * this.itemTypes.length)];
ย ย ย ย ย ย ย ย const speed = 0.5 + this.score / 200;
ย ย ย ย ย ย ย ย this.items.push({
ย ย ย ย ย ย ย ย ย ย x: Math.random() * (this.canvas.width - 60) + 30,
ย ย ย ย ย ย ย ย ย ย y: -30,
ย ย ย ย ย ย ย ย ย ย icon: randomType.icon,
ย ย ย ย ย ย ย ย ย ย type: randomType.type,
ย ย ย ย ย ย ย ย ย ย speed: speed,
ย ย ย ย ย ย ย ย ย ย isDragging: false
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย }

ย ย ย ย ย ย draw() {
ย ย ย ย ย ย ย ย this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย this.bins.forEach(bin => {
ย ย ย ย ย ย ย ย ย ย this.ctx.drawImage(bin.image, bin.x, bin.y, bin.width, bin.height);
ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = '#fff';
ย ย ย ย ย ย ย ย ย ย this.ctx.font = 'bold 16px Raleway';
ย ย ย ย ย ย ย ย ย ย this.ctx.textAlign = 'center';
ย ย ย ย ย ย ย ย ย ย this.ctx.fillText(bin.name, bin.x + bin.width / 2, bin.y + bin.height + 20);
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย this.items.forEach(item => {
ย ย ย ย ย ย ย ย ย ย this.ctx.font = '30px Raleway';
ย ย ย ย ย ย ย ย ย ย this.ctx.textAlign = 'center';
ย ย ย ย ย ย ย ย ย ย this.ctx.fillText(item.icon, item.x, item.y);
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย }

ย ย ย ย ย ย update(deltaTime) {
ย ย ย ย ย ย ย ย this.spawnTimer += deltaTime;
ย ย ย ย ย ย ย ย const spawnInterval = 2000 - Math.min(this.score * 5, 1500);
ย ย ย ย ย ย ย ย if (this.spawnTimer > spawnInterval) {
ย ย ย ย ย ย ย ย ย ย this.spawnItem();
ย ย ย ย ย ย ย ย ย ย this.spawnTimer = 0;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย this.timer -= deltaTime / 1000;

ย ย ย ย ย ย ย ย this.items.forEach(item => {
ย ย ย ย ย ย ย ย ย ย if (!this.isDragging || item !== this.draggedItem) {
ย ย ย ย ย ย ย ย ย ย ย ย item.y += item.speed * deltaTime / 16.67;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย this.items = this.items.filter(item => {
ย ย ย ย ย ย ย ย ย ย if (item.y > this.canvas.height + 20) {
ย ย ย ย ย ย ย ย ย ย ย ย this.lives -= 1;
ย ย ย ย ย ย ย ย ย ย ย ย this.incorrectSound.triggerAttackRelease('C3', '8n');
ย ย ย ย ย ย ย ย ย ย ย ย this.canvas.classList.add('flash-red');
ย ย ย ย ย ย ย ย ย ย ย ย setTimeout(() => this.canvas.classList.remove('flash-red'), 500);
ย ย ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย return true;
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย this.scoreEl.textContent = `Puntos: ${this.score}`;
ย ย ย ย ย ย ย ย this.livesEl.textContent = `Vidas: ${'โค๏ธ'.repeat(Math.max(0, this.lives))}`;
ย ย ย ย ย ย ย ย this.timerEl.textContent = `Tiempo: ${Math.max(0, Math.floor(this.timer))}`;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (this.lives <= 0 || this.timer <= 0) this.gameOver = true;
ย ย ย ย ย ย }

ย ย ย ย ย ย gameLoop(currentTime) {
ย ย ย ย ย ย ย ย if (this.gameOver) {
ย ย ย ย ย ย ย ย ย ย this.messageTitleEl.textContent = "ยกJuego Terminado!";
ย ย ย ย ย ย ย ย ย ย this.messageTextEl.textContent = `ยกHas conseguido ${this.score} puntos!`;
ย ย ย ย ย ย ย ย ย ย this.messageBoxEl.style.display = 'flex';
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (this.paused) {
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const deltaTime = currentTime - this.lastTime;
ย ย ย ย ย ย ย ย this.lastTime = currentTime;
ย ย ย ย ย ย ย ย this.update(deltaTime);
ย ย ย ย ย ย ย ย this.draw();
ย ย ย ย ย ย ย ย this.frameId = requestAnimationFrame(this.gameLoop.bind(this));
ย ย ย ย ย ย }
ย ย ย ย }
ย ย ย ยย
ย ย ย ย window.onload = function() {
ย ย ย ย ย ย const canvas = document.getElementById('gameCanvas');
ย ย ย ย ย ย const gameScoreEl = document.getElementById('gameScore');
ย ย ย ย ย ย const gameLivesEl = document.getElementById('gameLives');
ย ย ย ย ย ย const gameTimerEl = document.getElementById('gameTimer');
ย ย ย ย ย ย const messageBoxEl = document.getElementById('messageBox');
ย ย ย ย ย ย const messageTitleEl = document.getElementById('messageTitle');
ย ย ย ย ย ย const messageTextEl = document.getElementById('messageText');
ย ย ย ย ย ย const restartButtonEl = document.getElementById('restartButton');
ย ย ย ย ย ย const toggleButtonEl = document.getElementById('toggleButton');
ย ย ย ย ย ย const toggleIconEl = document.getElementById('toggleIcon');
ย ย ย ย ย ย const toggleTextEl = document.getElementById('toggleText');
ย ย ย ย ย ย const restartGameButtonEl = document.getElementById('restartGameButton');
ย ย ย ย ย ย const returnButtonEl = document.getElementById('returnButton');
ย ย ย ย ย ย const backGameButtonEl = document.getElementById('backGameButton');

ย ย ย ย ย ย const game = new RecyclingGame(canvas, gameScoreEl, gameLivesEl, gameTimerEl, messageBoxEl, messageTitleEl, messageTextEl, restartButtonEl, toggleButtonEl, toggleIconEl, toggleTextEl, returnButtonEl, backGameButtonEl);
ย ย ย ย ย ย window.addEventListener('resize', game.resizeCanvas);
ย ย ย ย ย ย game.start();

ย ย ย ย ย ย restartGameButtonEl.addEventListener('click', () => game.restart());
ย ย ย ย };
ย ย </script>
</body>
</html>
